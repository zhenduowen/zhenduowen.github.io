---
title: Barvinok’s algorithm for linearly constrained integer counting
date: 2025-12-12
author: Zhenduo
categories: [Applied Mathematics, Combinatorics]
tags: [Combinatorics, Barvinok’s algorithm]
published: false
---

Barvinok’s algorithm is an efficient way (in *fixed dimension*) to count integer lattice points in a rational polytope by turning the counting problem into **algebra with generating functions**.

Below is the core intuition, with a small 2D example.

## 1. From “count points” to a generating function

Given a set $S\subseteq \mathbb Z^d$, define its (multivariate) generating function
$$
f_S(\mathbf z)\;=\;\sum_{\mathbf m\in S}\mathbf z^{\mathbf m},
\quad\text{where }\mathbf z^{(m_1,\dots,m_d)}:=z_1^{m_1}\cdots z_d^{m_d}.
$$

If you can represent $f_{P\cap \mathbb Z^d}$ compactly, then you can extract information from it—especially the **total count**
$$
|P\cap\mathbb Z^d| \;=\; f_{P\cap\mathbb Z^d}(1,1,\dots,1),
$$
interpreted as a suitable limit (because rational forms will have poles at $1$).


## 2. Key geometric fact (Brion’s theorem): reduce to cones at vertices

If $P$ is a bounded polytope, then the generating function of its lattice points can be written as a sum of generating functions of its **tangent cones** at vertices:
$$
f_{P\cap\mathbb Z^d}(\mathbf z)
\;=\;
\sum_{v\in \mathrm{Vert}(P)}
f_{(v + C_v)\cap\mathbb Z^d}(\mathbf z).
$$

So you reduce a polytope problem to a small number of **cone** problems.


## 3. Why unimodular cones are “easy”

A simplicial cone in $\mathbb R^d$ generated by integer rays $u_1,\dots,u_d$ is **unimodular** if $|\det[u_1\ \cdots\ u_d]|=1$. Intuitively: the rays form a lattice basis, so every lattice point in the cone has a **unique** expression
$$
v + \lambda_1 u_1 + \cdots + \lambda_d u_d,\quad \lambda_i\in\mathbb Z_{\ge 0}.
$$

Then the generating function is just a product of geometric series:
$$
f_{(v+C)\cap\mathbb Z^d}(\mathbf z)
\;=\;
\frac{\mathbf z^v}{(1-\mathbf z^{u_1})\cdots(1-\mathbf z^{u_d})}.
$$

So: **unimodular cone ⇒ simple rational function.**


## 4. The hard part: cones are not usually unimodular

If $|\det|>1$, the cone contains lattice points that are *not* uniquely representable as nonnegative combinations of the generating rays. The generating function is still rational, but “not as nice”.

**Barvinok’s big idea:**  
Represent any (fixed-dimensional) cone as a **short signed sum** of unimodular cones:
$$
[C] \;\equiv\; \sum_{k} \epsilon_k [C_k],\qquad \epsilon_k\in\{+1,-1\},
$$
so
$$
f_C(\mathbf z) \;=\; \sum_k \epsilon_k f_{C_k}(\mathbf z),
$$
and each $f_{C_k}$ has the simple product form above.

The cancellations (the $\pm$) are what keep the representation short.


## 5. A simple 2D example of the “cone decomposition” step

Consider the 2D cone at the origin generated by
$$
u_1=(2,1),\qquad u_2=(0,1).
$$
The determinant is
$$
\det\begin{pmatrix}2&0\\1&1\end{pmatrix}=2,
$$
so it is **not unimodular**.

Barvinok-style move: introduce an intermediate integer ray
$$
w=(1,1)
$$
which lies between the two rays, and split the cone into two unimodular cones, with inclusion–exclusion on the overlap:

- $C_1=\operatorname{cone}(u_1,w)$ has determinant $\det[(2,1),(1,1)]=1$ ⇒ unimodular.
- $C_2=\operatorname{cone}(w,u_2)$ has determinant $\det[(1,1),(0,1)]=1$ ⇒ unimodular.
- Their intersection is the ray $\operatorname{cone}(w)$.

As indicator functions (and correspondingly as generating functions):
$$
[C] = [C_1] + [C_2] - [\operatorname{cone}(w)].
$$

Now write generating functions in variables $(X,Y)$ where $(a,b)\mapsto X^aY^b$. Then
$$
\mathbf z^{u_1}=X^2Y,\quad \mathbf z^{u_2}=Y,\quad \mathbf z^{w}=XY.
$$

So the cone generating function becomes a **signed sum of simple fractions**:
$$
\boxed{
f_C(X,Y)
=
\frac{1}{(1-X^2Y)(1-XY)}
+
\frac{1}{(1-XY)(1-Y)}
-
\frac{1}{(1-XY)}.
}
$$

That’s the essence of Barvinok: replace a “complicated cone” by a **short** expression using only unimodular cones.


## 6. Putting it together for a polytope

For a polytope $P$:

1. Use **Brion’s theorem**: write $f_{P\cap\mathbb Z^d}$ as a sum over vertex tangent cones.
2. For each cone, apply **Barvinok decomposition** into unimodular cones.
3. You get a “short” rational-function representation of $f_{P\cap\mathbb Z^d}$.
4. To get the **count**, evaluate at $\mathbf z=\mathbf 1$ via a controlled limit/series expansion (the algorithm manages pole cancellation systematically).


## 7. Why it’s fast (and when it isn’t)

- In **fixed dimension $d$**, the number of unimodular pieces needed can be bounded so the runtime is polynomial in the input size.
- The dependence on $d$ is exponential—so it’s great for $d=2,3,4,\dots$ but not for very high dimension.
