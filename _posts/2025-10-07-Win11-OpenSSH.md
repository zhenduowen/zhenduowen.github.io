---
title: Windows 11 build-in SSH server
description: How to SSH into Windows 11?
date: 2025-10-07
author: Zhenduo
categories: [General, ]
tags: [General]
published: false
---

## Install SSH Server on Windows 11

- [https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse?tabs=powershell&pivots=windows-11](https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse?tabs=powershell&pivots=windows-11)

To install OpenSSH using PowerShell:

- Run PowerShell as an Administrator.

- Run the following cmdlet to make sure that OpenSSH is available:

    ```PowerShell
    Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*'
    ```
- The command should return the following output if neither are already installed:

    ```PowerShell
    Name  : OpenSSH.Client~~~~0.0.1.0
    State : NotPresent

    Name  : OpenSSH.Server~~~~0.0.1.0
    State : NotPresent
    ```

- After that, run the following cmdlets to install the server or client components as needed:

    ```PowerShell
    # Install the OpenSSH Client
    Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0

    # Install the OpenSSH Server
    Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
    ```

    Both commands should return the following output:

    ```PowerShell
    Path          :
    Online        : True
    RestartNeeded : False
    ```

- To start and configure OpenSSH Server for initial use, open an elevated PowerShell prompt (right-click, then select Run as an administrator), then run the following commands to start the sshd service:

    ```PowerShell
    # Start the sshd service
    Start-Service sshd

    # OPTIONAL but recommended:
    Set-Service -Name sshd -StartupType 'Automatic'

    # Confirm the Firewall rule is configured. It should be created automatically by setup. Run the following to verify
    if (!(Get-NetFirewallRule -Name "OpenSSH-Server-In-TCP" -ErrorAction SilentlyContinue)) {
        Write-Output "Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it..."
        New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
    } else {
        Write-Output "Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists."
    }
    ```

## Connect to WSL through SSH from a Mac

> https://github.com/ajithmoola/wsl-ssh-guide

An alternative way is to use sub-net ip within CUHK. And we can setup port forwarding from windows to WSL.

**1. Set up SSH Server in WSL**

- Install the OpenSSH server:
`sudo apt install openssh-server`
- Edit the SSH configuration file: `sudo vim /etc/ssh/sshd_config`
    add the following lines
    ```vim
    Port 2222
    PasswordAuthentication no
    PubkeyAuthentication yes
    ```
    save and quit.
- Start the SSH service: `sudo service ssh start`

**2. Set up Port Forwarding on Windows**

- Open PowerShell as Administrator on Windows.
- Get your WSL IP address and set up port forwarding:
```powershell
netsh interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=2222 connectaddress=$((wsl hostname -I).trim())
```

**3. Configure Windows Firewall**
- Open Windows Defender Firewall with Advanced Security.
- Click on "Inbound Rules" and then "New Rule".
- Choose "Port" and click Next.
- Select "TCP" and enter "2222" for the port number.
- Allow the connection and apply the rule to all profiles.
- Name the rule (e.g., "WSL SSH") and finish the wizard.

**4. Generate SSH Key on MacL**

- Open Terminal on your Mac.
- Generate a new SSH key:
`ssh-keygen -t rsa -b 4096`
- Follow the prompts, using the default file location and adding a passphrase if desired.
- Display your public key:
`cat ~/.ssh/id_rsa.pub`

**5. Configure SSH on WSL**
- Copy the SSH key. In your WSL terminal:
    ```terminal
    mkdir -p ~/.ssh
    vim ~/.ssh/authorized_keys
    ```
Paste your public key into this file, save, and exit.
- Set correct permissions:
    ```terminal
    chmod 700 ~/.ssh
    chmod 600 ~/.ssh/authorized_keys
    ```

**6. Configure SSH on Mac**

- On Mac, edit your SSH config file:
`vim ~/.ssh/config`
    Add the following:
    ```vim
    Host wsl
    HostName <WINDOWS_IP>
    User <WSL_USERNAME>
    Port 2222
    IdentityFile ~/.ssh/id_rsa
    ```
    Replace <WINDOWS_IP> with your Windows machine's IP address and <WSL_USERNAME> with your WSL username.